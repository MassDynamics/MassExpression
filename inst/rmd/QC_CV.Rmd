---
title: "Coefficient of variation distributions"
output:
  html_document:
    theme: united
    toc: no
    fig_caption: yes
    lib_dir: qc_report_files
params:
  listInt: empty
  format: pdf
  output_figure: figures
---


<style type="text/css">

summary {
  text-decoration: underline;
  font-size: 16px;
  color: grey;
  cursor: pointer;
  margin-bottom: 16px;
}

summary, summary:active {
  border: none;
}

details span {
  margin-top: 8px;
  display: block;
}

#header .btn-group {
  display: none;
}

.main-container {
  max-width: 1400px !important;
}
</style>

--- 

```{r setup, include=FALSE}
print(params)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, 
                      fig.path = params$output_figure, dev = "svg")
```


```{r data-needed, include=FALSE, eval=TRUE}
library(dplyr)
library(stringr)
library(MassExpression)
library(plotly)
library(kableExtra)

CompleteIntensityExperiment <- params$listInt$CompleteIntensityExperiment
IntensityExperiment <- params$listInt$IntensityExperiment
design <- colData(IntensityExperiment)

comparisonExperiments <- 
    listComparisonExperiments(CompleteIntensityExperiment)
```


<details>
  <summary>Coefficient of Variation details</summary>
  <span>
    <p>The Coefficient of Variation (CV) or Relative Standard Deviation, is calculated by the ratio of the standard deviation to the mean. It is used to measure the precision of a measure, in this case protein/peptide intensity. The plot below shows the distribution of the CVs by experimental conditions where each CV is calculated by protein and by experimental condition. The CV is displayed as %CV, which is the percentage of the mean represented by the standard deviation.  </p>
   <p>For a healthy experiment we expect:</p>
    <ul>
      <li>The distribution of the CVs across conditions to be mostly overlapping, e.g. similar modes</li>
      <li>The modes of the CVs not to be too high, ideally not above 50%</li>
    </ul>
    <p>If the distributions show worringly large %CV, this could affect the quality of the differential expression analysis.<p>
  </span>
</details> 

```{r cv-dist}
p=plot_condition_cv_distribution(IntensityExperiment, title = NULL)

ggplotly(p[[1]]) %>% plotly::config(displayModeBar = T, 
                        modeBarButtons = list(list('toImage')),
                        displaylogo = F)
```

  
```{r cv-table, eval=TRUE, warning=FALSE, echo=FALSE, error=FALSE, message=FALSE, results='asis'}
cv_data <- p[[2]]
cv_data <- as_tibble(cv_data) %>% group_by(Condition) %>%
  summarise(`Median CV %` = round(median(cv, na.rm = TRUE)*100))

cv_data %>%
  kbl() %>%
  kable_styling(full_width = F, position = "left")
```
