---
title: "Principal Component Analysis"
output:
  html_document:
    theme: united
    toc: no
    fig_caption: yes
    lib_dir: qc_report_files
params:
  listInt: empty
  experiment: empty
  format: pdf
  output_figure: figures
---


<style type="text/css">

summary {
  text-decoration: underline;
  font-size: 16px;
  color: grey;
  cursor: pointer;
  margin-bottom: 16px;
}

summary, summary:active {
  border: none;
}

details span {
  margin-top: 8px;
  display: block;
}

#header .btn-group {
  display: none;
}

.main-container {
  max-width: 1400px !important;
}
</style>

--- 

```{r setup, include=FALSE}
print(params)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, 
                      fig.path = params$output_figure, dev = "svg")
```


```{r data-needed, include=FALSE, eval=TRUE}
library(dplyr)
library(stringr)
library(MassExpression)
library(plotly)

CompleteIntensityExperiment <- params$listInt$CompleteIntensityExperiment
IntensityExperiment <- params$listInt$IntensityExperiment
design <- colData(IntensityExperiment)

comparisonExperiments <- 
    listComparisonExperiments(CompleteIntensityExperiment)
```


<details>
  <summary>Principal Component Analysis details</summary>
  <span>
    <p>The Principal Component Analysis (PCA) plot is used to visualise differences between samples that are induced by their intensity profiles. PCA transforms high-dimensional data, like thousands of measured proteins or peptides intensities, into a reduced set of dimensions. The first two dimensions explain the greatest variability between the samples and they are a useful visual tool to confirm known clustering of the samples or to identify potential problems in the data. </p>
    <p>This section displays two PCA plots:</p>
    <ul>
      <li>Using all intensities (imputed and normalised, when requested) used for the differential expression (DE) analysis.</li>
      <li>Including only differentially expressed (DE) proteins. The DE proteins are defined as those proteins with an adjusted p-value < 0.05, where the p-value is the one of the limma ANOVA test which tests for differences using all categories of the condition of interest jointly. At least 5 DE proteins are required to produce this plot.</li>
    </ul>
    <p>For a healthy experiment we expect:</p>
    <ul>
      <li>Technical Replicates to cluster tightly together.</li>
      <li>Biological Replicates to cluster more than non replicates.</li>
      <li>Clustering of the condition of interest should be visible</li>
    </ul>
    <p> If unexpected clusters occur or replicates don't cluster together it can be due to extra variability introduced by factors such as technical processing, other unexplored biological differences, sample swaps etc... The interpretation and trust in the the differential expression results should take these consideration into a account. If you think that the samples in the experiment show largely unexpected patterns, it is advisable to request support from an analyst. </p>
    <p>A scree plot shows the amount of variance explained by each dimension extracted by PCA. A high degree of variance in the first few dimensions may suggest large differences between your samples.</p>
  </span>
</details> 

```{r pca-imputed}
## PCA
p=plot_pca_experiment(CompleteIntensityExperiment, format = params$format, title = NULL)
p[[1]]
```


```{r  scree-plot-pca}
p[[2]]
```