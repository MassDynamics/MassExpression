---
title: "Test imports"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("proteomics", force = TRUE)
```


```{r}
library(tidyverse)
library(limma)
library(proteomics)
library("rpx")
```


## MaxQuant SILAC

### Test import of SILAC data

Expected input:
- Matrix of intensities/ratios - wide format 
- Matrix of sample information (do we enforce column names?)

```{r}
pg <- read_delim("../data/maxquant/SILAC/paper-sample-dataset/proteinGroups.txt",  "\t", escape_double = FALSE, trim_ws = TRUE)
design <- read_delim("../data/maxquant/SILAC/paper-sample-dataset/experimentalDesign.txt",  "\t", escape_double = FALSE, trim_ws = TRUE)
head(pg)

protein.id.col <- NULL
protein.ids.col <- "Majority protein ID"
intensity_columns <- c("")
```


## DIA-NN

```{r}
library(devtools)
install_github("https://github.com/vdemichev/diann-rpackage")
library(diann)
```


This is the final report that once would get from DIA-NN. 

```{r}
int_table <- diann_load("../data/dia-nn/test-data-rpackage/data/diann_report.tsv")
protein.groups <- diann_maxlfq(df[df$Q.Value <= 0.01 & df$PG.Q.Value <= 0.01,], group.header="Protein.Group", id.header = "Precursor.Id", quantity.header = "Precursor.Normalised")

protein_df <- tibble(protein_id = rownames(protein.groups), protein.groups)
colnames(protein_df)[2:ncol(protein_df)] <- colnames(protein.groups)
sample_info <- tibble(runs = levels(int_table$File.Name), groups = c(1,1,0))
```

Using R we can parse that output further to obtain peptides and protein groups. Would a user do that normally? Maybe we don't care how they get there. 

```{r}
precursors <- diann_matrix(df, pg.q = 0.01)
peptides <- diann_matrix(df, id.header="Stripped.Sequence", pg.q = 0.01)
peptides.maxlfq <- diann_maxlfq(df[df$Q.Value <= 0.01 & df$PG.Q.Value <= 0.01,], group.header="Stripped.Sequence", id.header = "Precursor.Id", quantity.header = "Precursor.Normalised")
unique.genes <- diann_matrix(df, id.header="Genes", quantity.header="Genes.MaxLFQ.Unique", proteotypic.only = T, pg.q = 0.01)
```


### DIA-NN data proteomeXchange

```{r}
px <- PXDataset("PXD014690")
```

